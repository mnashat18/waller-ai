<div class="min-h-screen bg-[#0b1020] text-white relative overflow-hidden">
  <div class="absolute inset-0 opacity-30"
       style="background: radial-gradient(circle at top, rgba(37, 99, 235, 0.55), transparent 60%);"></div>
  <div class="absolute inset-0 opacity-20"
       style="background: radial-gradient(circle at 20% 10%, rgba(96, 165, 250, 0.65), transparent 50%);"></div>
  <div class="absolute inset-0 opacity-10"
       style="background-image: radial-gradient(#ffffff 1px, transparent 1px); background-size: 40px 40px;"></div>
  <span class="mobile-orb" style="top: 90px; right: -12px;"></span>
  <span class="mobile-orb gold" style="bottom: 140px; left: -12px;"></span>
  <span class="mobile-sparkle" style="top: 160px; left: 36px;"></span>

  <div class="relative z-10 px-5 pt-6 pb-28">
    <div class="flex items-start justify-between">
      <div>
        <p class="text-xs uppercase tracking-[0.2em] text-slate-400">Compliance Center</p>
        <h1 class="text-2xl font-semibold mt-2">Audit Logs</h1>
        <p class="text-xs text-slate-400 mt-1">Report wellness issues and track responses.</p>
      </div>
      <div class="flex items-center gap-3">
        <app-notifications></app-notifications>
        <a
          routerLink="/profile"
          class="w-10 h-10 rounded-full bg-white/10 flex items-center justify-center">
          <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
            <circle cx="12" cy="7" r="4"></circle>
          </svg>
        </a>
      </div>
    </div>

    <div class="mt-5 rounded-2xl bg-white/5 border border-white/10 p-4">
      <div class="flex items-center justify-between text-xs text-slate-400 uppercase tracking-[0.2em]">
        <span>Create Log</span>
        <span class="text-[10px] tracking-normal">{{ logs.length }} logs</span>
      </div>

      <div class="mt-4 space-y-3">
        <div>
          <label class="text-xs text-slate-400 uppercase tracking-[0.2em]">Email</label>
          <input
            #emailInput
            class="mt-2 w-full rounded-xl border border-white/10 bg-slate-900/60 px-3 py-2 text-sm"
            [value]="currentUserEmail"
            [readonly]="!canReviewLogs"
            placeholder="name@example.com" />
          <p *ngIf="!canReviewLogs" class="text-[10px] text-slate-400 mt-2">
            Your email is locked to protect privacy. Logs are visible only to admins and managers.
          </p>
        </div>

        <div>
          <label class="text-xs text-slate-400 uppercase tracking-[0.2em]">Type</label>
          <input
            #typeInput
            class="mt-2 w-full rounded-xl border border-white/10 bg-slate-900/60 px-3 py-2 text-sm"
            placeholder="Fatigue / Focus / Risk / Other" />
        </div>

        <div>
          <label class="text-xs text-slate-400 uppercase tracking-[0.2em]">Description</label>
          <textarea
            #descriptionInput
            rows="3"
            class="mt-2 w-full rounded-xl border border-white/10 bg-slate-900/60 px-3 py-2 text-sm"
            placeholder="Describe the issue clearly..."></textarea>
        </div>

        <div>
          <label class="text-xs text-slate-400 uppercase tracking-[0.2em]">Metadata (JSON)</label>
          <textarea
            #metadataInput
            rows="3"
            class="mt-2 w-full rounded-xl border border-white/10 bg-slate-900/60 px-3 py-2 text-xs font-mono"
            placeholder='{ "sleep_hours": 4, "stress": "high" }'></textarea>
        </div>

        <button
          type="button"
          class="w-full bg-[#f5c451] text-slate-900 py-3 rounded-2xl font-semibold shadow-lg"
          (click)="submitLog(emailInput.value, typeInput.value, descriptionInput.value, metadataInput.value)">
          Submit Log
        </button>

        <p
          *ngIf="submitFeedback as feedback"
          class="text-xs"
          [ngClass]="{
            'text-green-400': feedback.type === 'success',
            'text-red-400': feedback.type === 'error',
            'text-slate-400': feedback.type === 'info'
          }">
          {{ feedback.message }}
        </p>
      </div>
    </div>

    <div class="mt-6" *ngIf="canViewLogs; else accessDeniedMobile">
      <div class="flex items-center justify-between text-xs text-slate-400 uppercase tracking-[0.2em]">
        <span>{{ canReviewLogs ? 'All Logs' : 'My Logs' }}</span>
        <span class="text-[10px] tracking-normal">{{ logs.length }} total</span>
      </div>

      <div class="mt-3 space-y-3" *ngIf="logs.length; else emptyLogs">
        <button
          type="button"
          class="w-full text-left rounded-2xl bg-white/5 border border-white/10 p-4"
          *ngFor="let log of logs"
          (click)="openLog(log)">
          <div class="flex items-center justify-between gap-2">
            <p class="text-sm font-semibold truncate">{{ log.user }}</p>
            <span class="badge" [ngClass]="badgeClass(log.type)">{{ log.type }}</span>
          </div>
          <p class="mt-2 text-xs text-slate-400 truncate">{{ log.description }}</p>
          <div class="mt-3 flex items-center justify-between text-[10px] text-slate-400">
            <span>{{ log.timestamp }}</span>
            <span>{{ log.adminResponse ? 'Replied' : 'Pending' }}</span>
          </div>
        </button>
      </div>
    </div>

    <ng-template #emptyLogs>
      <div class="mt-3 rounded-2xl bg-white/5 border border-white/10 p-4 text-sm text-slate-400">
        No audit logs yet.
      </div>
    </ng-template>
  </div>

  <div
    *ngIf="canViewLogs && selectedLog as log"
    class="fixed inset-0 z-50 flex items-end justify-center bg-slate-950/60 px-4 pb-6">
    <div class="w-full max-w-sm rounded-3xl border border-slate-800 bg-slate-900 p-5 shadow-2xl">
      <div class="flex items-start justify-between">
        <h3 class="text-lg font-semibold">Log Details</h3>
        <button class="text-slate-400 hover:text-slate-200" (click)="closeLog()">x</button>
      </div>

      <div class="mt-4 space-y-2 text-xs text-slate-300">
        <p><span class="text-slate-500">Email:</span> {{ log.user }}</p>
        <p><span class="text-slate-500">Type:</span> {{ log.type }}</p>
        <p><span class="text-slate-500">Date:</span> {{ log.timestamp }}</p>
      </div>

      <div class="mt-4">
        <p class="text-xs uppercase tracking-[0.2em] text-slate-400">Description</p>
        <p class="mt-2 text-sm text-slate-200">
          {{ log.description }}
        </p>
      </div>

      <div class="mt-4">
        <p class="text-xs uppercase tracking-[0.2em] text-slate-400">Admin Response</p>
        <p class="mt-2 text-sm text-slate-200">
          {{ log.adminResponse || 'No response yet.' }}
        </p>
        <p *ngIf="log.responseTimestamp" class="text-[10px] text-slate-500 mt-1">
          {{ log.responseTimestamp }}
          <span *ngIf="log.responseBy">Â· {{ log.responseBy }}</span>
        </p>
      </div>

      <div class="mt-4">
        <p class="text-xs uppercase tracking-[0.2em] text-slate-400">Metadata</p>
        <pre class="mt-2 max-h-40 overflow-auto rounded-2xl border border-white/10 bg-slate-950/60 p-3 text-[10px] text-slate-300">
{{ log.metadata | json }}
        </pre>
      </div>
    </div>
  </div>

  <ng-template #accessDeniedMobile>
    <div class="mt-6 rounded-2xl bg-white/5 border border-white/10 p-4 text-sm text-slate-400">
      Please sign in to view your audit logs.
    </div>
  </ng-template>

  <nav class="fixed bottom-4 left-1/2 -translate-x-1/2 w-[calc(100%-2.5rem)] bg-slate-900/80 backdrop-blur border border-slate-800 rounded-2xl px-4 py-3 z-20">
    <div class="grid grid-cols-6 text-[10px] text-slate-400">
      <a routerLink="/audit-logs" routerLinkActive="text-white" class="flex flex-col items-center gap-1">
        <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
          <path d="M9 12h6"></path>
          <path d="M9 16h6"></path>
          <path d="M5 8h14v12H5z"></path>
        </svg>
        <span>Audit logs</span>
      </a>
      <a
        *ngIf="hasBusinessAccess"
        routerLink="/requests/create"
        class="flex flex-col items-center gap-1">
        <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
          <path d="M12 5v14"></path>
          <path d="M5 12h14"></path>
        </svg>
        <span>Create</span>
      </a>
      <a routerLink="/dashboard" routerLinkActive="text-white" [routerLinkActiveOptions]="{ exact: true }" class="flex flex-col items-center gap-1">
        <div class="w-11 h-11 rounded-full bg-[#f5c451] text-slate-900 flex items-center justify-center -mt-6 shadow-lg">
          <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            <path d="M3 11.5L12 4l9 7.5"></path>
            <path d="M5 10.5V20h14v-9.5"></path>
          </svg>
        </div>
        <span class="mt-2 text-white">Home</span>
      </a>
      <a routerLink="/requests" routerLinkActive="text-white" class="flex flex-col items-center gap-1">
        <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
          <path d="M4 7h16"></path>
          <path d="M4 12h16"></path>
          <path d="M4 17h16"></path>
        </svg>
        <span>Requests</span>
      </a>
      <a *ngIf="hasBusinessAccess" routerLink="/business-center" routerLinkActive="text-white" class="flex flex-col items-center gap-1">
        <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
          <path d="M4 20V8l8-4 8 4v12"></path>
          <path d="M8 20v-5h8v5"></path>
          <path d="M9 10h.01"></path>
          <path d="M15 10h.01"></path>
        </svg>
        <span>Business</span>
      </a>
      <a routerLink="/history" routerLinkActive="text-white" class="flex flex-col items-center gap-1">
        <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
          <path d="M3 12a9 9 0 1 0 9-9"></path>
          <path d="M3 4v6h6"></path>
          <path d="M12 7v5l3 3"></path>
        </svg>
        <span>History</span>
      </a>
    </div>
  </nav>
</div>
