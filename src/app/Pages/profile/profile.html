<div class="page-shell fade-in profile-shell">

  <div class="page-hero">
    <div class="profile-hero-left">
      <div class="profile-avatar">
        <img
          *ngIf="avatarPreviewUrl || profile?.avatarUrl"
          [src]="avatarPreviewUrl || profile?.avatarUrl"
          alt="Profile avatar" />
        <span *ngIf="!avatarPreviewUrl && !profile?.avatarUrl">{{ profile?.initials || 'W' }}</span>
      </div>
      <div class="profile-meta">
        <span class="hero-chip">Account Profile</span>
        <h1 class="page-title">{{ profile?.name || 'Wellar User' }}</h1>
        <p class="page-subtitle">{{ profile?.email }}</p>
        <div class="profile-badges">
          <span class="badge badge-stable">{{ profile?.status || 'Active' }}</span>
          <span class="badge badge-low">{{ profile?.roleLabel || 'User' }}</span>
        </div>
      </div>
    </div>

    <div class="hero-visual">
      <span class="hero-orb"></span>
      <span class="hero-orb gold"></span>
      <span class="hero-orb indigo"></span>
      <span class="sparkle" style="top: 18px; left: 34px;"></span>
      <span class="sparkle gold" style="bottom: 20px; right: 34px;"></span>
      <svg viewBox="0 0 220 160" fill="none" xmlns="http://www.w3.org/2000/svg">
        <rect x="28" y="24" width="164" height="112" rx="18" stroke="rgba(125,211,252,0.6)" stroke-width="2"/>
        <circle class="pulse-dot" cx="110" cy="70" r="24" stroke="#7dd3fc" stroke-width="3"/>
        <path class="pulse-line" d="M72 122c10-16 26-24 38-24 12 0 28 8 38 24" stroke="#f5c451" stroke-width="3" stroke-linecap="round"/>
      </svg>
    </div>

    <div class="profile-actions">
      <button class="btn-primary px-5 py-2 rounded-full" (click)="startEdit()">Edit Profile</button>
      <button class="chip" (click)="logout()">Logout</button>
    </div>
  </div>

  <div *ngIf="loading" class="profile-grid">
    <div class="panel skeleton-card"></div>
    <div class="panel skeleton-card"></div>
    <div class="panel skeleton-card"></div>
  </div>

  <div *ngIf="!loading && errorMessage" class="panel">
    {{ errorMessage }}
  </div>

  <div *ngIf="editing && profile" class="panel">
    <div class="panel-header">
      <div>
        <h3 class="panel-title">Edit Profile</h3>
        <p class="text-slate-400 text-sm">Update your name, avatar, and password.</p>
      </div>
      <button class="chip" (click)="cancelEdit()">Cancel</button>
    </div>

    <div class="profile-form">
      <div class="profile-field">
        <label>First Name</label>
        <input class="profile-input" name="firstName" [(ngModel)]="form.firstName" />
      </div>
      <div class="profile-field">
        <label>Last Name</label>
        <input class="profile-input" name="lastName" [(ngModel)]="form.lastName" />
      </div>
      <div class="profile-field">
        <label>Title (locked)</label>
        <input class="profile-input" [value]="profile.title" disabled />
      </div>
      <div class="profile-field">
        <label>Email (locked)</label>
        <input class="profile-input" [value]="profile.email" disabled />
      </div>
      <div class="profile-field">
        <label>New Password</label>
        <input
          class="profile-input"
          type="password"
          name="password"
          placeholder="********"
          [(ngModel)]="form.password" />
      </div>
      <div class="profile-field">
        <label>Profile Photo</label>
        <input class="profile-input" type="file" (change)="onAvatarSelected($event)" />
      </div>
    </div>

    <div class="profile-form__actions">
      <button class="btn-primary px-5 py-2 rounded-full" [disabled]="saving" (click)="saveProfile()">Save Changes</button>
      <span *ngIf="saveFeedback as info" class="profile-feedback" [ngClass]="info.type">
        {{ info.message }}
      </span>
    </div>
  </div>

  <div *ngIf="!loading && profile" class="profile-grid">
    <div class="panel">
      <h3 class="panel-title">Account Details</h3>
      <div class="profile-row">
        <span>Email</span>
        <strong>{{ profile.email }}</strong>
      </div>
      <div class="profile-row">
        <span>Password</span>
        <strong>********</strong>
      </div>
      <div class="profile-row">
        <span>Role</span>
        <strong>{{ profile.roleLabel }}</strong>
      </div>
      <div class="profile-row">
        <span>Status</span>
        <strong>{{ profile.status }}</strong>
      </div>
    </div>

    <div class="panel">
      <h3 class="panel-title">Membership</h3>
      <div class="profile-row">
        <span>Member Since</span>
        <strong>{{ profile.memberSince }}</strong>
      </div>
      <div class="profile-row">
        <span>Last Access</span>
        <strong>{{ profile.lastAccess }}</strong>
      </div>
      <div class="profile-row">
        <span>Account ID</span>
        <strong>{{ profile.id }}</strong>
      </div>
    </div>

    <div class="panel">
      <h3 class="panel-title">Profile Summary</h3>
      <p class="text-slate-400">
        {{ profile.title }}
      </p>
      <div class="profile-row">
        <span>Primary Email</span>
        <strong>{{ profile.email }}</strong>
      </div>
    </div>
  </div>
</div>
