<div class="page-shell fade-in">

  <div class="page-hero">
    <div class="hero-left">
      <span class="hero-chip">Scan History</span>
      <h1 class="page-title">History</h1>
      <p class="page-subtitle">All wellness scan results with detailed medical context.</p>
    </div>
    <div class="hero-actions">
      <span class="chip">Total scans: {{ scans.length }}</span>
      <a routerLink="/dashboard" class="chip">Back to Dashboard</a>
    </div>
    <div class="hero-visual">
      <span class="hero-orb"></span>
      <span class="hero-orb gold"></span>
      <span class="hero-orb indigo"></span>
      <span class="sparkle" style="top: 18px; left: 34px;"></span>
      <span class="sparkle gold" style="bottom: 20px; right: 34px;"></span>
      <svg viewBox="0 0 220 160" fill="none" xmlns="http://www.w3.org/2000/svg">
        <rect x="18" y="20" width="184" height="120" rx="16" stroke="rgba(125,211,252,0.6)" stroke-width="2"/>
        <path d="M52 52h116" stroke="rgba(226,232,240,0.5)" stroke-width="3" stroke-linecap="round"/>
        <path class="pulse-line" d="M52 80h90" stroke="#7dd3fc" stroke-width="3" stroke-linecap="round"/>
        <path d="M52 108h70" stroke="rgba(226,232,240,0.4)" stroke-width="3" stroke-linecap="round"/>
        <circle class="pulse-dot" cx="170" cy="80" r="10" fill="#38bdf8"/>
      </svg>
    </div>
  </div>

  <div class="info-grid">
    <div class="list-card" *ngFor="let scan of scans | slice:0:6" (click)="openScan(scan)">
      <div class="flex items-center justify-between">
        <p class="text-sm text-slate-400">{{ scan.date }}</p>
        <span
          class="badge"
          [ngClass]="{
            'badge-stable': scan.result === 'Stable',
            'badge-low': scan.result === 'Low Focus',
            'badge-fatigue': scan.result === 'Elevated Fatigue',
            'badge-risk': scan.result === 'High Risk'
          }">
          {{ scan.result }}
        </span>
      </div>
      <p class="mt-3 text-sm text-slate-300">{{ scan.report }}</p>
      <p class="mt-2 text-xs text-slate-400">Tap to view full report</p>
    </div>
  </div>

  <div class="panel">
    <div class="panel-header">
      <h3 class="panel-title">All Results</h3>
      <span class="chip">Latest first</span>
    </div>

    <div class="table-shell">
      <table>
        <thead>
          <tr>
            <th class="th">Date</th>
            <th class="th">Result</th>
            <th class="th">Details</th>
          </tr>
        </thead>
        <tbody>
          <tr
            class="row cursor-pointer"
            *ngFor="let scan of scans"
            (click)="openScan(scan)">
            <td>{{ scan.date }}</td>
            <td>
              <span
                class="badge"
                [ngClass]="{
                  'badge-stable': scan.result === 'Stable',
                  'badge-low': scan.result === 'Low Focus',
                  'badge-fatigue': scan.result === 'Elevated Fatigue',
                  'badge-risk': scan.result === 'High Risk'
                }">
                {{ scan.result }}
              </span>
            </td>
            <td>{{ scan.report }}</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

</div>

<!-- Scan Details Modal -->
<div *ngIf="selectedScan as scan"
     class="fixed inset-0 z-50 flex items-center justify-center bg-black/50">

  <div class="panel w-full max-w-2xl animate-scale">

    <div class="flex justify-between items-start mb-6">
      <div>
        <h2 class="text-xl font-semibold">Scan Details</h2>
        <p class="text-slate-400 text-sm">
          {{ scan.date }} - {{ scan.time }}
        </p>
      </div>

      <button
        (click)="closeScan()"
        class="text-slate-400 hover:text-slate-200 text-xl">
        x
      </button>
    </div>

    <div class="mb-6">
      <span
        class="badge"
        [ngClass]="{
          'badge-stable': scan.result === 'Stable',
          'badge-low': scan.result === 'Low Focus',
          'badge-fatigue': scan.result === 'Elevated Fatigue',
          'badge-risk': scan.result === 'High Risk'
        }">
        {{ scan.result }}
      </span>
    </div>

    <div class="panel mb-6">
      <h3 class="font-semibold mb-2">Medical Report</h3>
      <p class="text-slate-300 text-sm leading-relaxed">
        {{ scan.report }}
      </p>
    </div>

    <div class="grid grid-cols-2 gap-6 mb-6">
      <div class="panel">
        <p class="text-sm text-slate-400">Fatigue Level</p>
        <p class="font-medium mt-1 text-slate-100">
          {{ scan.fatigueLevel }}
        </p>
      </div>

      <div class="panel">
        <p class="text-sm text-slate-400">Focus Score</p>
        <p class="font-medium mt-1 text-slate-100">
          {{ scan.focusScore }}
        </p>
      </div>
    </div>

    <div class="panel">
      <p class="text-sm text-slate-400 mb-1">Recommendation</p>
      <p class="text-slate-200">
        {{ scan.recommendation }}
      </p>
    </div>

  </div>
</div>
